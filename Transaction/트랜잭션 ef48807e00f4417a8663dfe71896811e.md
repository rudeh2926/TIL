# 트랜잭션

---

## 정의

데이터베이스의 관리 시스템 또는 유사한 시스템에서 상호작용의 단위이다. 여기서 유사한 시스템이란 트랜잭션이 성공과 실패가 분명하고 상호 독립적이며, 일관되고 믿을 수 있는 시스템을 의미한다. 데이터의 정합성을 보장하기 위해 고안된 방법이다.

## 목적

- 오류로부터 복구를 허용하고 데이터베이스를 일관성있게 유지하는 안정적인 작업 단위를 제공한다
- 동시 접근하는 여러 프로그램 간 격리를 제공한다

---

## ACID

이론적으로 데이터베이스  시스템은 각각의 트랜잭션에 대해 원자성(`Atomicity`), 일관성(`Consistency`), 독립성(`Isolation`), 영구성(`Durability`)을 보장한다 이 성질을 앞글자를 따서 ACID

라 부른다

---

- 원자성(`Atomicity`)
    
    트랜잭션이 완전히 성공하거나 완전히 실패하는 단일 단위로 처리되도록 보장되는 능력이다.
    중간 단계까지 실행되고 실패하는 일이 없도록 하는 것이다
    
- 일관성(`Consistency`)
    
    각 데이터 트랜잭션이 데이터베이스를 일관성 있는 상태에서 일관성 있는 상태로 이동해야 함을 의미한다. 즉 트랜잭션이 성공적으로 완료하면 언제나 동일한 데이터베이스 상태로 유지하는 것을 의미
    
- 독립성(`Isolation`)
    
    트랜잭션을 수행 시 다른 트랜잭션의 연산 작업이 끼어들지 못하도록 보장하는 것을 의미한다. 이것은 트랜잭션 밖에 있는 어떤 연산도 중간 단계의 데이터를 볼 수 없음을 의미한다. 여러 트랜잭션이 동시에 발생하는 경우 최종 상태는 트랜잭션이 개별적으로 발생한 것과 같아야 한다
    
- 영구성(`Durability`)
    
    공적으로 수행된 트랜잭션은 영원히 반영(기록)되어야 함을 의미한다. 트랜잭션은 로그에 모든 것이 저장된 후에만 commit 상태로 간주될 수 있다. 데이터베이스 내의 데이터는 트랜잭션의 결과로만 변경되어야 하며 외부 영향에 의해 변경될 수 없어야 한다
    
    ---
    
    ## 트랙잭션 과정
    
    1. **트랜잭션 시작**
    2. **비즈니스 로직 실행** (여러 쿼리들이 실행) (DB내 갱신이 아직 적용되지 않는다)
    3. **트랜잭션 커밋** (트랜잭션이 성공적이며, 갱신이 실제 적용됨)
    
    만약 쿼리 하나가 실패하면, 데이터베이스 시스템은 전체 트랜잭션 또는 실패한 쿼리를 롤백한다.
    
    ---
    
    ## 범위
    
    전체 트랜잭션 범위는 하나의 완전한 작업 단위를 의미합니다. 트랜잭션의 시작부터 끝까지의 모든 작업이 하나의 원자적인 단위로 처리되어야 합니다.
    
    특정 작업들이 전체 트랜잭션의 일부로서 처리되는 경우 부분 트랜잭션이라고 합니다. 이러한 부분 트랜잭션은 전체 트랜잭션 내에서의 논리적인 단위로 취급될 수 있습니다
    
    ---
    
    ## 요약
    
    특정 실행단위에서 오류 발생시 전체 실행 내용을 `롤백`해주는 기능
    
    ---
    
    `@Transactional(readOnly = *true*)`
    
    사용하는 이유는 flush 를 사용 안해 속도가 더 빨라진다