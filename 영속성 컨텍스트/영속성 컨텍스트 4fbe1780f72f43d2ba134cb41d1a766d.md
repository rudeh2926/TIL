# 영속성 컨텍스트

---

## **영속성 컨텍스트란?**

엔티티를 영구 저장하는 환경. 애플리케이션과 데이터베이스 사이에서 객체를 보관하는 가상의 데이터베이스 역할을 한다. 

- 엔티티 조회/저장 시 영속성 컨텍스트에 엔티티 보관
    
    `persist()`  메소드는 엔티티 메니저를 사용해서 회원 엔티티를 영속성 컨텍스트에 저장한다 
    
    이 영속성 컨텍스트는 엔티티 매니저를 통해서 접근할 수 있다
    

---

## 영속성 컨텍스트의 특징

영속 상태는 식별자 값(PK)이 있어야 한다

[PK(primary Key) ](https://www.notion.so/PK-primary-Key-0ce8cc9827fc4e6488f34c7578e46f06?pvs=21)

---

## 영속성 컨텍스트의 장점

- 1차 캐시에서 조회
    
    저장, 조회시 1차 캐시에 저장 됨 → 여기서 엔티티가 있으면 찾고 없으면 DB에서 조회  
    
- 동일성 보장

![Untitled](%E1%84%8B%E1%85%A7%E1%86%BC%E1%84%89%E1%85%A9%E1%86%A8%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%86%A8%E1%84%89%E1%85%B3%E1%84%90%E1%85%B3%204fbe1780f72f43d2ba134cb41d1a766d/Untitled.png)

- 쓰기지연
엔티티 매니저는 트랜잭션을 커밋하기 직전까지 DB에 저장하지 않고 **쓰기지연 SQL 저장소에 쿼리를 모으고 커밋할때 DB에 보낸다**. (함께저장, 함께롤백)

![Untitled](%E1%84%8B%E1%85%A7%E1%86%BC%E1%84%89%E1%85%A9%E1%86%A8%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%86%A8%E1%84%89%E1%85%B3%E1%84%90%E1%85%B3%204fbe1780f72f43d2ba134cb41d1a766d/Untitled%201.png)

- 변경감지 
JPA로 엔티티를 수정할 때는 엔티티 데이터만 변경하면 된다. 즉 , 엔티티 변경사항을 
DB에 자동으로 반영하는 기술을 변경감지라 한다 = 엔티티와 스냅샷을 비교하여 변경된 엔티티를 찾아서(플러시) 쿼리 생성

→ 모든 필드 업데이트(쿼리 동일)

**변경 감지는 영속성 컨텍스트가 관리하는 영속 상태의 엔티티에만 적용된다**

---

[플러시/커밋](%E1%84%8B%E1%85%A7%E1%86%BC%E1%84%89%E1%85%A9%E1%86%A8%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%86%A8%E1%84%89%E1%85%B3%E1%84%90%E1%85%B3%204fbe1780f72f43d2ba134cb41d1a766d/%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B5%20%E1%84%8F%E1%85%A5%E1%84%86%E1%85%B5%E1%86%BA%20a99a7a3c281541eea6ba8fc94a0a09d2.md)